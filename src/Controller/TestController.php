<?php

namespace App\Controller;

use stdClass;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpKernel\Exception\HttpExceptionInterface;

class TestController extends AbstractController
{
    #[Route('/test', name: 'app_test')]
    /**
     * La "fonction" Route :
     *  1er argument : le chemin relatif. TOUJOURS commencer par /
     * 
     *  Ensuite les arguments sont not√©s avec leur nom. Par 
     *  exemple, name, qui sera le nom utilis√© pour utiliser
     *  cette route (pour un lien ou pour une redirection)
     * 
     * La m√©thode index du controleur TestController
     * @ Route("/test", name="app_test")
     * @return Response objet de la classe Response

     * @Route("/test", name="app_test")
     */
    public function index(): Response
    {
        return $this->json([
            'message' => 'Welcome to your new controller!',
            'path' => 'src/Controller/TestController.php',
        ]);
    }

    #[Route("/test/salut8", name: 'app_test_salut')]
    public function salut8()
    {
        return $this->render("test/salut.html.twig");
    }
    /**
     * @Route("/test/salut")
     */
    public function salut()
    {
        return $this->json([ "salut" => "hello" ]);
    }

    // TODO EXO : cr√©ez une route /test/aujourdhui qui affiche la date du jour
    // date("d/m/Y")
    /**
     * @Route("/test/aujourdhui")
     */
    public function auj()
    {   
        return $this->json([ "auj" => date("d/m/Y") ]);
    }

    /**
     * @Route("/test/message")
     */
    public function message()
    {
        /* 
            ? Voici un exemple de messages flashes en m√©moire. C'est un array associatif d'array
            ?    [                                                                              
            ?        "danger" => [                                                              
            ?                        "la requ√™te a √©chou√©",                                     
            ?                        "la bdd n'a pas √©t√© modifi√©",                              
            ?                        "erreur d'identifiants"                                    
            ?                    ],                                                             
            ??                                                                                  
            ?        "success" => [                                                             
            ?                        "requ√™te r√©alis√©e avec succ√®s",                            
            ?                        "nouveau livre enregistr√© avec succ√®s",                    
            ?                        "identifiants corrects"                                    
            ?                    ],                                                             
            ??                                                                                  
            ?        "info"   => [                                                              
            ?                        "une nouvelle version est disponible",                     
            ?                        "il reste 2 jours pour profiter de l'offre",               
            ?                        "Vous √™tes maintenant connect√©"                            
            ?                    ],                                                             
            ?    ]                                                                              
            ??                                                                                  
        */
        return $this->render("test/message.html.twig", [
            "message" => "Voici le message √† afficher"
        ]);
    }

    /**
     * Pour g√©n√©rer l'affichage, on utilise la m√©thode render
     *    1e argument : le fichier vue que l'on veut afficher
     *                  le nom du fichier est donn√© √† partir du dossier "templates"
     *    2e argument : un array qui contient les variables n√©c√©ssaires √† la vue
     *                  Les indices de cet array correspondent aux noms des variables
     *                  dans le fichier twig
     * 
     * Pour retourner une page 404 : Controller::createNotFoundException($message)
     * Pour retourner une page 403 : Controller::createAccessDeniedException($message)
     * 
     * 
     * @Route("/affiche-titre", name="app_test_titre")
     */
    public function titre()
    {
        throw $this->createNotFoundException('Page 404');
        throw $this->createAccessDeniedException("Page 403");
        return $this->render("test/titre.html.twig");
    }

    /**
     * @Route("/test/boucle", name="app_test_boucle")
     */
    public function boucle()
    {
        return $this->render("/test/boucle.html.twig", [ "taille" => 75 ]);
    }

    /**
     * @Route("/test/boucle/{taille}", name="app_test_param", requirements={"taille"="[0-9]+"})
     * 
     * Dans l'URL, la partie entre {} est dynamique. La valeur peut √™tre diff√©rente √† chaque 
     * appel.
     * Pour r√©cup√©rer la valeur pass√©e dans l'url, il faut d√©finir un param√®tre dans la m√©thode
     * (le param√®tre a le m√™me nom que ce qui est entre {})
     * 
     * REGEX : la cha√Æne de caract√®res doit correspondre au mod√®le d√©fini dans la regex (expression r√©guil√®re)
     *  [0-9] : le caract√®re doit √™tre compris entre le 0 et le 9
     *  \d    : le caract√®re doit √™tre un chiffre (d pour digit, chiffre en anglais)
     *    +   : le caract√®re pr√©c√©dent le + doit √™tre pr√©sent au moins 1 fois
     *    *   : le caract√®re pr√©c√©dent le * peut √™tre pr√©sent 0 fois ou autant que l'on veut
     *    ?   : le caract√®re pr√©c√©dent le + ne peut √™tre pr√©sent qu'1 fois
     */
    public function routeAvecParametre($taille)
    {
        return $this->render("/test/boucle.html.twig", [ "taille" => $taille ]);
    }

    /**
     * @Route("/test/tableau", name="app_test_tableau")
     */
    public function tableau()
    {
        $variable = [ "nom" => "Faim", "prenom" => "Roger", "age" => 32 ];

        return $this->render("test/variable.html.twig", [ "variable" => $variable]);
    }

    /**
     * @Route("/test/objet", name="app_test_objet")
     */
    public function objet()
    {
        $objet = new stdClass;
        $objet->prenom = "G√©rard";
        $objet->nom = "Menfaim";

        return $this->render("test/variable.html.twig", [ "variable" => $objet ]);
    }
    
    /**
    * @Route("/test/erreur", name="app_test_erreur")
    */
    public function erreur() {
        throw new \Exception("Error Processing Request", 1);
        
    }

    /*
        ? $this->getUser() permet de r√©cup√©rer un objet de la classe Abonne contenant
        ? les informations de l'utilisateur connect√©. 
        ? Vaut NULL si l'utilisateur n'est pas connect√©.
    */


    /*
        ?  L'objet de la classe Request a des propri√©t√©s publiques de type objet qui contiennent toutes 
        ?  les valeurs des variables superglobales de PHP.
        ?       $request->query         contient        $_GET
        ?       $request->request       contient        $_POST
        ?       $request->files         contient        $_FILES
        ?       $request->server        contient        $_SERVER
        ?       $request->cookies       contient        $_COOKIES
        ?       $request->session       contient        $_SESSION
        ?   Ces diff√©rents objets ont des m√©thodes communes : get, has,...    
        ?   La m√©thode get() permet de r√©cup√©rer la valeur voulue.
        ?   ùíÜÃ≤ÃÖùíôÃ≤ÃÖ : $motRecherche = $request->query->get("search");  
        ?        $motRecherche = $_GET["search"]
    */

    /*
        ? COURS : 
        ? Pour g√©n√©rer l'affichage, on utilise la m√©thode render
        ?     1er argument   : le fichier vue que l'on veut afficher
        ?         le nom du fichier est donn√© √† partir du dossier "templates"
        ?     2i√®me argument : un array qui contient les variables n√©c√©ssaires √† la vue
        ?         Les indices de cet array correspondent aux noms des variables
        ?         dans le fichier twig
            
        ? La fonction paginate va filter les produits √† afficher selon le num√©ro de page demand√©
        ?     1e argument : la liste totale des produits √† afficher
        ?     2e argument : le num√©ro de la page actuelle
        ?     3e argument : le nombre de produits affich√©s par page
    */

    /* 
        ? Voici un exemple de messages flashes en m√©moire. C'est un array associatif d'array
        ?    [
        ?        "danger" => [
        ?                        "la requ√™te a √©chou√©",
        ?                        "la bdd n'a pas √©t√© modifi√©",
        ?                        "erreur d'identifiants"
        ?                    ],
        ?        "success" => [
        ?                        "requ√™te r√©alis√©e avec succ√®s",
        ?                        "nouveau livre enregistr√© avec succ√®s",
        ?                        "identifiants corrects"
        ?                    ],
        ?        "info"   => [
        ?                        "une nouvelle version est disponible",
        ?                        "il reste 2 jours pour profiter de l'offre",
        ?                        "Vous √™tes maintenant connect√©"
        ?                    ],
        ?    ]        
    
    */

    /*
     * @Route("/calculatrice/{a}/{b}", requirements={"a"="\d+", "b"="\d+"})
      
        ? Une route param√©tr√©e est d√©finie par un chemin dont une partie est un param√®tre
        ? Cette partie du chemin, indiqu√© entre {} est le nom du param√®tre. 
        ? Pour r√©cup√©rer sa valeur, il faut ajouter un argument √† la m√©thode de la route. 
        ? L'argument doit avoir le m√™me nom.
        
        ? requirements est une option qui permet de pr√©ciser √† quoi doit ressembler un param√®tre
        ?      requirements utilise les expressions r√©guli√®res (REGEX)
            
        ? PHP : Quand on pr√©cise le type des arguments dans une fonction, si il y a un ?
        ? avant le type cela signifie que l'argument peut √™tre de type null
        ?      ex: ?string         soit c'est un string, soit c'est null
        ?      RAPPEL : en PHP, null est un type de donn√©es (comme int, array, object, boolean, ...)
            
        ? SYMFONY : pour qu'un param√®tre d'une route soit optionnel il faut ajouter un ?
        ?           apr√®s le param√®tre en question dans les {}
     */
    #[Route('/calculatrice/{a}/{b?}', requirements:['a' => '\d+', 'b' => '\d+'])]
    public function calculatrice(int $a, ?int $b)
    {
        // dd($b);
        return $this->render("test/calculatrice.html.twig", [ "a" => $a, "b" => $b ]);
    }
    /* 
        TODO     AFFICHEZ sous forme de table HTML (<table>), les indices et les valeurs du 
        TODO     tableau
        TODO 
        TODO     | indices  | valeurs  |
        TODO     |----------|----------|
        TODO     | nom      |  Mentor  |
        TODO     | prenom   |  G√©rard  |
    */

}
